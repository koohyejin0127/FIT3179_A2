{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Schools per 100k",
  "params": [{"name": "state_select", "value": "Malaysia"}],
  "data": {
    "url": "https://raw.githubusercontent.com/koohyejin0127/FIT3179_A2/refs/heads/main/data/school_dist.csv",
    "format": {"type": "csv"}
  },
  "transform": [
    {"filter": "datum.date == '1/1/2022'"},
    {
      "joinaggregate": [
        {"op": "mean", "field": "schools_per_100k", "as": "malaysia_avg_rate"}
      ]
    },
    {
      "calculate": "state_select == 'Malaysia' ? datum.malaysia_avg_rate : datum.schools_per_100k",
      "as": "display_value"
    },
    {"filter": "state_select == 'Malaysia' || datum.state == state_select"}
  ],
  "mark": {
    "type": "text",
    "align": "center",
    "baseline": "middle",
    "fontSize": 22
  },
  "encoding": {
    "text": {"field": "display_value", "type": "quantitative", "format": ".2f"}
  },
  "config": {}
}