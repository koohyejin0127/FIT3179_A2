{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Enrolment by Education Level Across States",
  "data": {
    "url": "https://raw.githubusercontent.com/koohyejin0127/FIT3179_A2/refs/heads/main/data/enrolment_filtered.csv"
  },
  "params": [{"name": "state_select", "value": "Malaysia"}],
  "transform": [
    {"filter": "datum.date == '1/1/2022'"},
    {"filter": "datum.state != 'Malaysia'"},
    {"calculate": "datum.stage == 'primary' ? 1 : datum.stage == 'secondary' ? 2 : 3",
    "as": "xpos"
    },
    {"calculate": "toNumber(datum.students)", "as": "students_num"},
    {
      "window": [{"op": "max", "field": "students_num", "as": "max_students"}],
      "groupby": ["state"]
    },
    {
      "calculate": "(datum.students / datum.max_students)",
      "as": "students_percentage"
    }
  ],
  "spacing": {"row": 1},
  "facet": {
    "row": {
      "field": "state",
      "type": "nominal",
      "header": {
        "title": "State",
        "labelAngle": 0,
        "labelAlign": "left",
        "labelPadding": -45,
        "titlePadding": 5
      }
    }
  },
  "spec": {
    "mark": "area",
    "width": 400,
    "height": 20,
    "view": {"stroke": null},
    "encoding": {
      "x": {
        "field": "xpos",
        "type": "ordinal",
        "title": "Education Level",
        "scale": {"paddingInner": 0, "paddingOuter": 0},
        "axis": {
          "values": [1, 2, 3],
          "labelExpr": "datum.value == 1 ? 'Primary' : datum.value == 2 ? 'Secondary' : 'Tertiary'",
          "labelAngle": 0
        }
      },
      "y": {
        "field": "students_percentage",
        "type": "quantitative",
        "scale": {"zero": false},
        "axis": {
          "title":null, 
          "labels": false, 
          "ticks": false}
      },
      "color": {
        "field": "state",
        "type": "nominal",
        "legend": null,
        "scale": {"scheme": "category20b"}
      },
      "opacity": {
      "condition": {
        "test": "state_select == 'Malaysia' || datum.state == state_select",
        "value": 1
      },
      "value": 0.2
      },
      "tooltip": [
        {"field": "state", "title": "State"},
        {"field": "stage", "title": "Education Level"},
        {"field": "students", "title": "Number of Students"},
        {"field": "students_percentage", "format": "%", "title": "% of Primary Enrolment"}
      ]
    }
  },
  "config": {"axis": {"grid": false, "domain": false}}
}
