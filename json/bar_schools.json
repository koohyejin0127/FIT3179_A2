{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Government Schools by Education Level",
  "width": 400,
  "height": 400,
  "data": {
    "url": "https://raw.githubusercontent.com/koohyejin0127/FIT3179_A2/refs/heads/main/data/school_enrol.csv"
  },
  "params": [{"name": "state_select", "value": "Malaysia"}],
  "transform": [
    {"filter": "datum.date == '1/1/2022'"},
    {
      "calculate": "datum.stage == 'primary' ? 'Primary' : datum.stage == 'secondary' ? 'Secondary' : 'Tertiary'",
      "as": "edu_level"
    },
    {
      "joinaggregate": [
        {"op": "sum", "field": "schools", "as": "total_schools"}
      ],
      "groupby": ["state"]
    },
    {"calculate": "datum.schools / datum.total_schools", "as": "percentage"}
  ],
  "layer": [
    {  "mark": "bar",
  "encoding": {
    "y": {"field": "state", "title": "State"},
    "x": {
      "field": "schools",
      "type": "quantitative",
      "title": "Number of Schools",
      "stack": "normalize"
    },
    "color": {
      "field": "edu_level",
      "title": "Education Level",
      "scale": {
        "domain": [
          "Primary", 
          "Secondary", 
          "Tertiary"
        ],
        "range": ["#ef5675", "#7a5195", "#003f5c"]
      }
    },
    "opacity": {
      "condition": {
        "test": "state_select == 'Malaysia' || datum.state == state_select",
        "value": 1
      },
      "value": 0.2
    },
    "tooltip": [
      {"field": "edu_level", "title": "Education Level"},
      {"field": "schools", "title": "Number of Schools"},
      {"field": "percentage", "title": "Percentage of Schools", "format": ".1%"}]
      }
    },
    {
      "mark": {
      "type": "text",
      "align":"left",
      "dx": 5
      },
      "transform": [{"filter": "datum.edu_level == 'Tertiary' && datum.state == 'Perlis'"}],
      "encoding": {
        "x": {"aggregate": "sum", "field": "schools"},
        "y": {"field": "state"},
        "text": {"value": "Tertiary is NOT missing!"}
      }
    }
  ]
}
